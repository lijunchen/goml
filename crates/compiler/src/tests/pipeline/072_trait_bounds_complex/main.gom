trait Display {
    fn show(Self) -> string;
}

trait Debug {
    fn show(Self) -> string;
}

trait Eq {
    fn eq(Self, Self) -> bool;
}

trait Hash {
    fn hash(Self) -> int32;
}

trait Add {
    fn add(Self, Self) -> Self;
}

trait Scale {
    fn scale(Self, int32) -> Self;
}

trait Inspect {
    fn inspect(Self) -> string;
}

struct Boxed { value: int32 }

impl Display for int32 {
    fn show(self: int32) -> string {
        int32_to_string(self)
    }
}

impl Debug for int32 {
    fn show(self: int32) -> string {
        "i32(" + int32_to_string(self) + ")"
    }
}

impl Eq for int32 {
    fn eq(self: int32, other: int32) -> bool {
        self == other
    }
}

impl Hash for int32 {
    fn hash(self: int32) -> int32 {
        (self * 16777619) + 216613626
    }
}

impl Add for int32 {
    fn add(self: int32, other: int32) -> int32 {
        self + other
    }
}

impl Scale for int32 {
    fn scale(self: int32, factor: int32) -> int32 {
        self * factor
    }
}

impl Inspect for int32 {
    fn inspect(self: int32) -> string {
        "<" + int32_to_string(self) + ">"
    }
}

impl Display for Boxed {
    fn show(self: Boxed) -> string {
        "Boxed(" + int32_to_string(self.value) + ")"
    }
}

impl Debug for Boxed {
    fn show(self: Boxed) -> string {
        "Boxed{value=" + int32_to_string(self.value) + "}"
    }
}

impl Eq for Boxed {
    fn eq(self: Boxed, other: Boxed) -> bool {
        self.value == other.value
    }
}

impl Hash for Boxed {
    fn hash(self: Boxed) -> int32 {
        ((self.value * 31) + 7) * 1315423911
    }
}

impl Add for Boxed {
    fn add(self: Boxed, other: Boxed) -> Boxed {
        Boxed { value: self.value + other.value }
    }
}

impl Scale for Boxed {
    fn scale(self: Boxed, factor: int32) -> Boxed {
        Boxed { value: self.value * factor }
    }
}

impl Inspect for Boxed {
    fn inspect(self: Boxed) -> string {
        "[" + int32_to_string(self.value) + "]"
    }
}

fn bool_text(x: bool) -> string {
    if x { "true" } else { "false" }
}

fn combine_and_render[T: Debug + Hash + Display + Eq + Add + Scale + Debug](a: T, b: T) -> string {
    let scaled = a.add(b).scale(2);
    let same = Eq::eq(a, b);
    let sum_hash = a.hash() + b.hash();
    let dbg = Debug::show(scaled);
    let disp = Display::show(scaled);
    (((dbg + " | ") + disp) + " | eq=") + (bool_text(same) + (" | hash=" + int32_to_string(sum_hash)))
}

fn sum_and_inspect[T: Add + Hash + Inspect](x: T, y: T, z: T) -> string {
    let total = x.add(y).add(z);
    let h = total.hash();
    (total.inspect() + " @") + int32_to_string(h)
}

fn main() {
    let _ = string_println(combine_and_render(10, 32));
    let _ = string_println(combine_and_render(Boxed { value: 3 }, Boxed { value: 4 }));
    let _ = string_println(sum_and_inspect(1, 2, 3));
    let _ = string_println(sum_and_inspect(Boxed { value: 5 }, Boxed { value: 6 }, Boxed { value: 7 }));
    ()
}
